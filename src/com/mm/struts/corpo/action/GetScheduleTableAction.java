/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.mm.struts.corpo.action;

import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.StringTokenizer;
import java.util.Vector;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import javax.sql.DataSource;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.mm.bean.StaffBean;
import com.mm.core.master.*;

/** 
 * MyEclipse Struts
 * Creation date: 07-03-2007
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class GetScheduleTableAction extends Action {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)throws Exception 
	{
		System.out.println("/n in GetScheduleTableAction line49:::");
		HttpSession session =request.getSession();
		DataSource dataSource = getDataSource(request, "corpo");
		StaffDao staffDao = new StaffDao();
		
		String numCount = (String)session.getAttribute("numCount");
		int count = Integer.parseInt(numCount);
		int remander = count%2;
		System.out.println("checkpoint at corpo 2");	

		String uId =(String)session.getAttribute("uId");
		String FacilityID =(String)session.getAttribute("fId");
		System.out.println("compId..in Action avdt ........."+FacilityID);

		String strResultTable = "<table border='1'>";
		strResultTable += "<tr><td>&nbsp;</td><td>Date</td><td>Shift Name</td>";
		Vector vecCategoryList = staffDao.getCategory(dataSource);
		if(vecCategoryList != null)
		{
			for(int k=0 ; k<vecCategoryList.size() ; k++)
			{
				StaffBean beanCategory = (StaffBean)vecCategoryList.elementAt(k);
				String strCategoryName = beanCategory.getCategoryName();
				strResultTable += "<td>"+strCategoryName+"</td>";		
			}
		}
		strResultTable += "</tr>";
		
		Vector vecScheduleDate = staffDao.getDistinctScheduleDtGivenFId(dataSource, Integer.parseInt(FacilityID));
	    if(vecScheduleDate != null)
	    {
			for(int i=0; i<vecScheduleDate.size(); i++)
			{
				StaffBean beanScheduleDate = (StaffBean)vecScheduleDate.elementAt(i);
				String strScheduleDate = beanScheduleDate.getScheuduleDate(); 
				
				Vector vecShiftList = staffDao.getShiftListGivenScheduleId_FId(dataSource, Integer.parseInt(FacilityID), strScheduleDate );
				if(vecShiftList != null)
				{
					for(int j=0 ; j<vecShiftList.size() ; j++ )
					{
						StaffBean Shiftbean = (StaffBean)vecShiftList.elementAt(j);
						int intShiftId = Shiftbean.getShiftId();
						String strShiftName = Shiftbean.getShiftName();
						//if(j == 0)
							strResultTable += "<tr><td><input type='checkbox' value='0' onclick='javascript:return fncCheckBoxClick(this.value);'></td> <td>"+strScheduleDate+"</td>";
						//else
							//strResultTable += "<tr><td><input type='checkbox'></td><td>&nbsp;</td>";
						strResultTable += "<td>"+strShiftName+"</td>";
						
						vecCategoryList = staffDao.getCategory(dataSource);
						
						if(vecCategoryList != null)
						{
							for(int k=0 ; k<vecCategoryList.size() ; k++)
							{
								StaffBean beanCategory = (StaffBean)vecCategoryList.elementAt(k);
								int intCategoryId = beanCategory.getCategoryId();
								String strCategoryName = beanCategory.getCategoryName();
								
								Vector vecStaffList = staffDao.getStaffListGivenShiftId_ScheduleDate_FId(dataSource, Integer.parseInt(FacilityID), strScheduleDate, intShiftId, intCategoryId);
								
								strResultTable += "<td>";
								if(vecStaffList != null)
								{
									strResultTable += "<table>";
									if(vecStaffList.size()==0)
										strResultTable += "<tr><td>--</td></tr>";
									for(int l=0 ; l<vecStaffList.size() ; l++)
									{
										ArrayList arrStaff = (ArrayList) vecStaffList.elementAt(l);
										int intSceduleId = (Integer)arrStaff.get(0);
										String strStaffName = (String)arrStaff.get(1);
										
										strResultTable += "<tr><td>"+strStaffName+"</td></tr>";
									}
									strResultTable += "</table>";
								}
								else
								{
									strResultTable += "--";
								}
								strResultTable += "</td>";
									
							}
						}

						strResultTable += "</tr>";
						
						
					}
				}
				
			}
	    }
	    strResultTable += "</table>";

System.out.println("strResultTable:::7878787:::::::"+strResultTable);
	    response.setContentType("text/html;charset=ISO-8859-1");
	    PrintWriter out = response.getWriter();
	    out.println(strResultTable);
	    out.flush();
		
		// TODO Auto-generated method stub
		return null;
	}
	
	private String getComplaintList(String strComFIdOrder, String strCTitelOrder,String strDateOrder, int minVal, int maxVal, int totalRow, String strPageHtml, Vector userVec, String pageid,String lowerSubTag,int regFlag, int remander)
	{

		String strValue = "";
		strValue += "<div class=\"top_panel\">";
		strValue += "<div class=\"Page_Heading\">";	
		strValue += "<div class=\"Page_Heading_Text\" style=\"width: 70%;\">List of Notices</div>";
		if(totalRow != 0)
		{
		strValue += "<div style=\"float: left;\">";
		strValue += "<a style=\"font-size: 10px; font-weight: bold; color: rgb(0, 0, 0);\">Total matches Found: "+totalRow+"</a></div>";
		}
		strValue += "</div>";
			
		if(userVec.size()==0)
		{if(lowerSubTag.equalsIgnoreCase("2"))
		{
			strValue +="<div class=\"Fields_Row_2_head\">";
			strValue +="<div class=\"Fields_Col_1a\">No Notice Found.";
			strValue += "</div></div>";
		
		}else
		{
			strValue +="<div class=\"Fields_Row_2_head\">";
			strValue +="<div class=\"Fields_Col_1a\">No Notice Found.";
			strValue += "</div></div>";
		
		}
		}
		else
		{
			
			if (totalRow > maxVal)
			{

				strValue +="<div class=\"Fields_Col_1a\">Page Number  "+strPageHtml+"\"div>";
			}
	    
	    
	    String strLoginIdSymbol = (strComFIdOrder.trim().equalsIgnoreCase("asc")) ? "<img style=\"cursor:hand\" src=\"../images/downarrow.gif\" onClick=\"retrieveClistURL('brandsExistingComplaint.do?sby=log.first_name&lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numMin="+ minVal+"&fidorder="+strComFIdOrder+"');\">" : "<img style=\"cursor:hand\" src=\"../images/uparrow.gif\" onClick=\"retrieveClistURL('brandsExistingComplaint.do?sby=log.first_name&lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numMin="+ minVal+"&fidorder="+strComFIdOrder+"');\">";
	    String strUnameSymbol = (strCTitelOrder.trim().equalsIgnoreCase("asc")) ? "<img style=\"cursor:hand\" src=\"../images/downarrow.gif\" onClick=\"retrieveClistURL('brandsExistingComplaint.do?sby=com.complaint_title&lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numMin="+ minVal+"&ctorder="+strCTitelOrder+"');\">" : "<img style=\"cursor:hand\" src=\"../images/uparrow.gif\" onClick=\"retrieveClistURL('brandsExistingComplaint.do?sby=com.complaint_title&lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numMin="+ minVal+"&ctorder="+strCTitelOrder+"');\">";
	    String strDateSymbol = (strDateOrder.trim().equalsIgnoreCase("asc")) ? "<img style=\"cursor:hand\" src=\"../images/downarrow.gif\" onClick=\"retrieveClistURL('brandsExistingComplaint.do?sby=com.creation_date&lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numMin="+ minVal+"&dateorder="+strDateOrder+"');\">" : "<img style=\"cursor:hand\" src=\"../images/uparrow.gif\" onClick=\"retrieveClistURL('brandsExistingComplaint.do?sby=com.creation_date&lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numMin="+ minVal+"&dateorder="+strDateOrder+"');\">";
	   
	    strValue += "<div class=\"Fields_Container\">";	
		strValue += "<div class=\"Fields_Container_Inside\">";
		
	    for(int i=0; i<userVec.size(); i++)
		{
	    	int j = i+1;
	    	int numTotal = j%2;
	    	String strColor = (numTotal==0) ? "#FFFFFF" : "#FFFFFF";
	    	String strImg = (numTotal==0) ? "detail_white.gif" : "detail_white.gif";
		 Vector tempVec = (Vector)userVec.elementAt(i);
		 
		 int comId = Integer.parseInt(tempVec.elementAt(0).toString().trim());
		 
		 
		 String strNTitle = tempVec.elementAt(1).toString().trim();
		 String strNText = tempVec.elementAt(2).toString().trim();
	//	 String strCity = tempVec.elementAt(8).toString().trim();
		 
		 
//		 	for check length of Complaint text
		 String strText = "";  
		 String strFMsg = "";
		 
			String strMessage =  tempVec.elementAt(2).toString().trim();
			////////System.out.println("complaintMessage........."+strMessage.length());
			////////System.out.println("complaintMessage........."+strMessage);
			int numChar = (strMessage.length() > 200) ? 200 : strMessage.length();  
			for(int k=0; k<numChar; k++)
			{ 
				
					   strFMsg = strFMsg+strMessage.charAt(k);
			}
			if(strFMsg.lastIndexOf(strFMsg)!=-1)
			{
				 strText= strFMsg;
				//////System.out.println("...strFMsgTeam......"+strFMsg.lastIndexOf(strFMsg));
				
	         
	        }else{
	        	strText= strFMsg.substring(0, strFMsg.lastIndexOf(" "));
	        	//////System.out.println("...strText......");
	        }
	     String strDate[] = tempVec.elementAt(3).toString().trim().split("-");
	     strValue += "<div class=\"Fields_Row_2_head\">";
			strValue += "<div class=\"Row_2_Fields_head_2\" style=\"width: 65%;\">Subject: "+strNTitle+"</div>";
			strValue += "<div class=\"Row_2_Fields_head_2\" style=\"width: 25%;\">   Dated:"+strDate[2]+"-"+strDate[1]+"-"+strDate[0]+"</div>";
			strValue += "</div>";
		    			
			
	    	strValue += "<div class=\"Fields_Row_1\">";
			
	        strValue += "<div class=\"Row_2_Fields_Col_2\" style=\"width: 70%;\">"+strText+"</div>";						
			strValue += "</div>";
	 
		}
	        
	    if (totalRow > maxVal)
		{
        strValue += "<tr >";
		strValue += "<td colspan=\"7\" align=\"right\" >Page Number"+strPageHtml+"</td>";		
		strValue += "</tr>";
		}
	    strValue += "</div></div>";
		}	
		if(remander==0)
		{
			strValue += "<tr style=\"display:none\" align=\"center\">";
			strValue += "<td height=\"50\" colspan=\"5\"></td>";
			strValue += "</tr>";
		}
	    strValue += "</div>";	
	    
		return strValue;
	}
	
	private String getPages(int minVal, int maxVal, int numSize ,String lowerSubTag,String pageid ,String numCount)
	{
		String strResult ="<select name=\"paging\" onchange=\"retrieveClistURL('brandsExistingComplaint.do?lowerSubTag="+lowerSubTag+"&pageid="+pageid+"&numCount="+numCount+"&'+this.value);\">";
		int numMin = 0;
		int numPage = 1;
		for(int i=0; i<numSize; i=i+maxVal)
		{
			numMin = i;
			
			if(minVal == numMin)
			{
				strResult += "<option value=\"numMin=" + numMin+"\" Selected>Page" + numPage + "</option>";
			}
			else
			{
				strResult += "<option value=\"numMin=" + numMin+"\">Page" + numPage + "</option>";
			}
				numPage++;
		}
		strResult += "</select>";
		return strResult;
	}
}